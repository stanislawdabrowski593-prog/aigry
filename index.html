<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>AIGRY v3.9</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #050505; color: #fff; margin: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        header { background: #111; width: 100%; padding: 10px; border-bottom: 2px solid #00d2ff; display: flex; justify-content: space-around; align-items: center; }
        .menu { display: flex; gap: 8px; margin: 15px; }
        button { background: #1a1a1a; color: #fff; border: 1px solid #333; padding: 8px 15px; cursor: pointer; border-radius: 4px; transition: 0.2s; }
        button:hover { border-color: #00d2ff; background: #222; }
        #game-box { position: relative; width: 800px; height: 450px; background: #000; border: 3px solid #1a1a1a; box-shadow: 0 0 20px rgba(0,210,255,0.2); }
        #ui { position: absolute; top: 10px; left: 10px; z-index: 10; font-weight: bold; text-shadow: 2px 2px #000; pointer-events: none; }
        #crosshair { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); color: #fff; display: none; font-size: 20px; z-index: 5; }
    </style>
</head>
<body oncontextmenu="return false;">

<header>
    <div style="font-size: 22px; font-weight: bold;">AIGRY <span style="color:#00d2ff">v3.9</span></div>
    <div class="menu">
        <button onclick="changeL('pl')">PL</button>
        <button onclick="changeL('en')">EN</button>
        <button onclick="changeL('de')">DE</button>
        <button onclick="changeL('fr')">FR</button>
    </div>
</header>

<div class="menu">
    <button onclick="start('mario')" id="btn-mario">SUPER MARIO</button>
    <button onclick="start('mc')" id="btn-mc">MINECRAFT 3D</button>
    <button onclick="start('snake')" id="btn-snake">SNAKE</button>
</div>

<div id="game-box">
    <div id="ui"></div>
    <div id="crosshair">+</div>
    <div id="content" style="width:100%; height:100%;"></div>
</div>

<script>
    let loop, keys = {}, marioLvl = 1, lang = 'pl', activeGame = '';
    const txt = {
        pl: {mario: "MARIO (POZIOM ", mc: "MINECRAFT: WSAD + MYSZ", snake: "SNAKE: PUNKTY ", build: "LPM: BUDUJ | PPM: USUŃ"},
        en: {mario: "MARIO (LEVEL ", mc: "MINECRAFT: WSAD + MOUSE", snake: "SNAKE: SCORE ", build: "LMB: BUILD | RMB: DIG"},
        de: {mario: "MARIO (LEVEL ", mc: "MINECRAFT: WSAD + MAUS", snake: "SNAKE: PUNKTE ", build: "LMB: BAUEN | RMB: LÖSCHEN"},
        fr: {mario: "MARIO (NIVEAU ", mc: "MINECRAFT: WSAD + SOURIS", snake: "SNAKE: SCORE ", build: "LMB: CONSTRUIRE | RMB: EFFACER"}
    };

    window.onkeydown = e => { keys[e.code] = true; if(e.code==='KeyF') toggleFS(); };
    window.onkeyup = e => keys[e.code] = false;

    function changeL(l) { lang = l; if(activeGame) start(activeGame); }
    function toggleFS() { let b = document.getElementById('game-box'); if(!document.fullscreenElement) b.requestFullscreen(); else document.exitFullscreen(); }

    function start(game) {
        activeGame = game;
        if(loop) cancelAnimationFrame(loop);
        document.getElementById('content').innerHTML = "";
        document.getElementById('crosshair').style.display = "none";
        if(game === 'mario') loadMario();
        if(game === 'mc') loadMC();
        if(game === 'snake') loadSnake();
    }

    // --- SUPER MARIO (LEPSZA GRAFIKA) ---
    function loadMario() {
        const cont = document.getElementById('content');
        cont.innerHTML = '<canvas id="mCnv" width="800" height="450"></canvas>';
        const cvs = document.getElementById('mCnv'), ctx = cvs.getContext('2d');
        let p = {x: 50, y: 350, w: 32, h: 48, vx: 0, vy: 0, j: false};
        let camX = 0, goal = 2000 + (marioLvl * 500);

        function mLoop() {
            if(keys['ArrowRight']) p.vx += 0.8; else if(keys['ArrowLeft']) p.vx -= 0.8; else p.vx *= 0.85;
            if((keys['Space'] || keys['ArrowUp']) && !p.j) { p.vy = -16; p.j = true; }
            p.vy += 0.7; p.x += p.vx; p.y += p.vy;
            if(p.y > 352) { p.y = 352; p.vy = 0; p.j = false; }
            if(p.x > 400) camX = p.x - 400;

            // Rysowanie
            ctx.fillStyle = "#5c94fc"; ctx.fillRect(0,0,800,450); // Niebo
            ctx.save(); ctx.translate(-camX, 0);
            
            // Paralaksowe chmury
            ctx.fillStyle = "rgba(255,255,255,0.8)";
            for(let i=0; i<10; i++) ctx.fillRect(i*400 - camX*0.3, 50 + (i%3)*30, 80, 40);

            // Ziemia z cieniowaniem
            ctx.fillStyle = "#8b4513"; ctx.fillRect(0, 400, goal+1000, 50);
            ctx.fillStyle = "#2ecc71"; ctx.fillRect(0, 400, goal+1000, 10); // Trawa

            // Flaga (Meta)
            ctx.fillStyle = "gold"; ctx.fillRect(goal, 100, 10, 300);
            
            // Postać (Mario z "cieniem")
            ctx.fillStyle = "rgba(0,0,0,0.2)"; ctx.fillRect(p.x+4, p.y+4, p.w, p.h);
            ctx.fillStyle = "#e74c3c"; ctx.fillRect(p.x, p.y, p.w, p.h);
            ctx.fillStyle = "#f1c40f"; ctx.fillRect(p.x+10, p.y+10, 12, 12); // "Guzik"

            ctx.restore();
            document.getElementById('ui').innerText = txt[lang].mario + marioLvl + ")";
            if(p.x > goal) { marioLvl++; start('mario'); }
            loop = requestAnimationFrame(mLoop);
        } mLoop();
    }

    // --- MINECRAFT (POPRAWIONY) ---
    function loadMC() {
        document.getElementById('crosshair').style.display = "block";
        const scene = new THREE.Scene(); scene.background = new THREE.Color(0x87CEEB);
        const cam = new THREE.PerspectiveCamera(75, 800/450, 0.1, 1000);
        const rend = new THREE.WebGLRenderer({antialias: true}); 
        rend.setSize(800, 450);
        document.getElementById('content').appendChild(rend.domElement);
        
        const geo = new THREE.BoxGeometry(1,1,1);
        const mat = new THREE.MeshLambertMaterial({color: 0x2ecc71});
        let blocks = [];

        for(let x=-8; x<8; x++) for(let z=-8; z<8; z++) {
            const b = new THREE.Mesh(geo, mat); b.position.set(x, 0, z); scene.add(b); blocks.push(b);
        }

        scene.add(new THREE.AmbientLight(0xffffff, 0.7));
        const sun = new THREE.DirectionalLight(0xffffff, 0.5); sun.position.set(5, 10, 5); scene.add(sun);
        cam.position.set(0, 2, 5);

        rend.domElement.onclick = () => rend.domElement.requestPointerLock();
        let y=0, p=0;
        document.addEventListener('mousemove', e => {
            if(document.pointerLockElement === rend.domElement){
                y -= e.movementX*0.002; p -= e.movementY*0.002; p = Math.max(-1.5, Math.min(1.5, p));
            }
        });

        rend.domElement.onmousedown = e => {
            if(document.pointerLockElement !== rend.domElement) return;
            const dir = new THREE.Vector3(0,0,-1).applyQuaternion(cam.quaternion);
            const pos = new THREE.Vector3().copy(cam.position).add(dir.multiplyScalar(3)).round();
            if(e.button === 0) {
                const b = new THREE.Mesh(geo, new THREE.MeshLambertMaterial({color: 0x7f8c8d}));
                b.position.copy(pos); scene.add(b); blocks.push(b);
            } else {
                blocks.forEach((b,i) => { if(b.position.distanceTo(pos) < 0.8) { scene.remove(b); blocks.splice(i,1); }});
            }
        };

        function mcLoop() {
            if(keys['KeyW']) cam.translateZ(-0.1); if(keys['KeyS']) cam.translateZ(0.1);
            if(keys['KeyA']) cam.translateX(-0.1); if(keys['KeyD']) cam.translateX(0.1);
            if(keys['Space']) cam.position.y += 0.1; if(keys['ShiftLeft']) cam.position.y -= 0.1;
            cam.rotation.set(p,y,0,'YXZ');
            rend.render(scene, cam);
            document.getElementById('ui').innerText = txt[lang].build;
            loop = requestAnimationFrame(mcLoop);
        } mcLoop();
    }

    // --- SNAKE ---
    function loadSnake() {
        const c = document.getElementById('content');
        c.innerHTML = '<canvas id="sCnv" width="800" height="450"></canvas>';
        const cvs = document.getElementById('sCnv'), ctx = cvs.getContext('2d');
        let s = [{x:200,y:200}], d = 'R', score = 0, f = {x:400,y:200}, last = 0;

        function sLoop(t) {
            if(t - last > 100) {
                last = t; let h = {...s[0]};
                if(keys['ArrowUp'] && d!=='D') d='U'; if(keys['ArrowDown'] && d!=='U') d='D';
                if(keys['ArrowLeft'] && d!=='R') d='L'; if(keys['ArrowRight'] && d!=='L') d='R';
                if(d==='U') h.y-=20; if(d==='D') h.y+=20; if(d==='L') h.x-=20; if(d==='R') h.x+=20;
                if(h.x===f.x && h.y===f.y) { score++; f={x:Math.floor(Math.random()*39)*20, y:Math.floor(Math.random()*22)*20}; } else s.pop();
                if(h.x<0||h.x>=800||h.y<0||h.y>=450) return start('snake');
                s.unshift(h);
                ctx.fillStyle="#111"; ctx.fillRect(0,0,800,450);
                ctx.fillStyle="#00d2ff"; s.forEach(p=>ctx.fillRect(p.x,p.y,18,18));
                ctx.fillStyle="#ff4757"; ctx.fillRect(f.x,f.y,18,18);
                document.getElementById('ui').innerText = txt[lang].snake + score;
            }
            loop = requestAnimationFrame(sLoop);
        } loop = requestAnimationFrame(sLoop);
    }
</script>
</body>
</html>
