<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>AIGRY v5.1 - ULTIMATE FIX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root { --accent: #00d2ff; --bg: #050505; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; display: flex; flex-direction: column; align-items: center; overflow: hidden; }
        header { background: #111; width: 100%; padding: 10px; border-bottom: 2px solid var(--accent); display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .menu { display: flex; gap: 10px; margin: 15px; }
        .btn { background: #1a1a1a; color: #fff; border: 1px solid #333; padding: 10px 20px; cursor: pointer; border-radius: 4px; font-weight: bold; transition: 0.2s; }
        .btn:hover { border-color: var(--accent); background: #222; }
        
        #game-window { position: relative; width: 900px; height: 500px; background: #000; border: 3px solid #1a1a1a; border-radius: 12px; overflow: hidden; }
        #game-window:fullscreen { width: 100vw; height: 100vh; border: none; border-radius: 0; }
        
        #hud { position: absolute; top: 15px; left: 15px; z-index: 50; font-family: monospace; font-size: 18px; color: var(--accent); text-shadow: 2px 2px #000; pointer-events: none; }
        #cross { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); color: #fff; display: none; font-size: 24px; z-index: 50; pointer-events: none; }
        
        .hotbar { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: none; gap: 8px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 8px; z-index: 50; }
        .slot { width: 40px; height: 40px; border: 2px solid #444; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; }
        .slot.active { border-color: var(--accent); box-shadow: 0 0 10px var(--accent); background: rgba(0,210,255,0.2); }
    </style>
</head>
<body oncontextmenu="return false;">

<header>
    <div style="font-size: 22px; font-weight: bold;">AIGRY <span style="color:var(--accent)">v5.1</span></div>
    <div class="menu">
        <button class="btn" onclick="launch('mario')">MARIO</button>
        <button class="btn" onclick="launch('mc')">MINECRAFT</button>
        <button class="btn" onclick="launch('snake')">SNAKE</button>
    </div>
</header>

<div id="game-window">
    <div id="hud">Wybierz grę...</div>
    <div id="cross">+</div>
    <div id="game-canvas" style="width:100%; height:100%;"></div>
    <div id="hotbar" class="hotbar"></div>
</div>

<button class="btn" style="margin-top: 15px; background: var(--accent); color: #000;" onclick="goFS()">TRYB PEŁNOEKRANOWY (F)</button>

<script>
    let loop, keys = {}, activeGame = '', lvl = 1, bid = 0;
    const win = document.getElementById('game-window');
    const hud = document.getElementById('hud');
    const colors = [0x2ecc71, 0x7f8c8d, 0x8b4513, 0x228b22, 0xadefff, 0xd35400, 0xf1c40f, 0x3498db, 0x2c3e50, 0xe1e1e1];
    const names = ["TRAWA", "KAMIEŃ", "PIEŃ", "LIŚCIE", "SZKŁO", "CEGŁY", "ZŁOTO", "DIAMENT", "WĘGIEL", "PIASEK"];

    window.onkeydown = e => { keys[e.code] = true; if(e.code === 'KeyF') goFS(); };
    window.onkeyup = e => keys[e.code] = false;

    function goFS() {
        if (!document.fullscreenElement) win.requestFullscreen();
        else document.exitFullscreen();
    }

    function launch(game) {
        activeGame = game;
        if(loop) cancelAnimationFrame(loop);
        document.getElementById('game-canvas').innerHTML = "";
        document.getElementById('cross').style.display = (game === 'mc') ? "block" : "none";
        document.getElementById('hotbar').style.display = (game === 'mc') ? "flex" : "none";
        if(game === 'mario') runMario();
        if(game === 'mc') runMC();
        if(game === 'snake') runSnake();
    }

    // --- MARIO 5.1 (FIXED) ---
    function runMario() {
        const stage = document.getElementById('game-canvas');
        stage.innerHTML = '<canvas id="marioC" width="900" height="500"></canvas>';
        const c = document.getElementById('marioC'), ctx = c.getContext('2d');
        let p = {x: 50, y: 350, w: 30, h: 45, vx: 0, vy: 0, j: false, dir: 1};
        let goal = 2500 + (lvl * 500), camX = 0;

        function update() {
            if(keys['ArrowRight'] || keys['KeyD']) { p.vx = 6; p.dir = 1; }
            else if(keys['ArrowLeft'] || keys['KeyA']) { p.vx = -6; p.dir = -1; }
            else p.vx *= 0.8;
            
            if((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && !p.j) { p.vy = -16; p.j = true; }
            p.vy += 0.8; p.x += p.vx; p.y += p.vy;

            if(p.y > 400) { p.y = 400; p.vy = 0; p.j = false; }
            if(p.x > 400) camX = p.x - 400;

            ctx.fillStyle = "#5c94fc"; ctx.fillRect(0,0,900,500);
            ctx.save(); ctx.translate(-camX, 0);
            ctx.fillStyle = "#8b4513"; ctx.fillRect(0, 445, goal+1000, 60);
            ctx.fillStyle = "#2ecc71"; ctx.fillRect(0, 445, goal+1000, 5);
            
            // MARIO DRAW
            ctx.fillStyle = "red"; ctx.fillRect(p.x, p.y, p.w, p.h);
            ctx.fillStyle = "white"; // OCZY
            let eyeX = p.dir === 1 ? p.x + 18 : p.x + 5;
            ctx.fillRect(eyeX, p.y + 10, 8, 8);
            ctx.fillStyle = "black";
            ctx.fillRect(p.dir === 1 ? eyeX+4 : eyeX, p.y + 12, 4, 4);

            ctx.fillStyle = "gold"; ctx.fillRect(goal, 145, 10, 300);
            ctx.restore();

            hud.innerText = "MARIO LVL: " + lvl + " | CEL: " + Math.floor(goal - p.x) + "m";
            if(p.x > goal) { lvl++; launch('mario'); }
            loop = requestAnimationFrame(update);
        } update();
    }

    // --- MINECRAFT 5.1 (NEW BLOCKS & OUTLINE) ---
    function runMC() {
        const scene = new THREE.Scene(); scene.background = new THREE.Color(0x87CEEB);
        const cam = new THREE.PerspectiveCamera(75, 900/500, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(900, 500); document.getElementById('game-canvas').appendChild(renderer.domElement);
        
        // HOTBAR INIT
        const hb = document.getElementById('hotbar'); hb.innerHTML = "";
        names.forEach((n, i) => {
            let s = document.createElement('div'); s.className = 'slot' + (i === 0 ? ' active' : '');
            s.style.backgroundColor = "#" + colors[i].toString(16).padStart(6, '0');
            s.innerText = i+1; hb.appendChild(s);
        });

        let blocks = [];
        for(let x=-8; x<8; x++) for(let z=-8; z<8; z++) {
            const b = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshLambertMaterial({color: colors[0]}));
            b.position.set(x, 0, z); scene.add(b); blocks.push(b);
        }

        scene.add(new THREE.AmbientLight(0xffffff, 0.7));
        const sun = new THREE.PointLight(0xffffff, 0.6); sun.position.set(10,20,10); scene.add(sun);
        cam.position.set(0, 2, 5);
        renderer.domElement.onclick = () => renderer.domElement.requestPointerLock();
        
        let yaw = 0, pitch = 0;
        document.addEventListener('mousemove', e => {
            if(document.pointerLockElement === renderer.domElement) {
                yaw -= e.movementX*0.002; pitch -= e.movementY*0.002;
                pitch = Math.max(-1.5, Math.min(1.5, pitch));
            }
        });

        renderer.domElement.onmousedown = e => {
            if(document.pointerLockElement !== renderer.domElement) return;
            const dir = new THREE.Vector3(0,0,-1).applyQuaternion(cam.quaternion);
            const pos = new THREE.Vector3().copy(cam.position).add(dir.multiplyScalar(4)).round();
            if(e.button === 0) {
                const b = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshLambertMaterial({
                    color: colors[bid], 
                    transparent: bid === 4, 
                    opacity: bid === 4 ? 0.6 : 1
                }));
                b.position.copy(pos); b.typeIdx = bid; scene.add(b); blocks.push(b);
            } else {
                blocks.forEach((b, i) => { if(b.position.distanceTo(pos) < 0.8) { scene.remove(b); blocks.splice(i, 1); }});
            }
        };

        function mcUpdate() {
            if(keys['KeyW']) cam.translateZ(-0.15); if(keys['KeyS']) cam.translateZ(0.15);
            if(keys['KeyA']) cam.translateX(-0.15); if(keys['KeyD']) cam.translateX(0.15);
            if(keys['Space']) cam.position.y += 0.1; if(keys['ShiftLeft']) cam.position.y -= 0.1;
            
            // ZMIANA BLOKU 1-0
            for(let i=1; i<=10; i++) {
                let k = "Digit" + (i % 10);
                if(keys[k]) {
                    bid = i-1;
                    Array.from(hb.children).forEach((s, idx) => s.classList.toggle('active', idx === bid));
                }
            }

            cam.rotation.set(pitch, yaw, 0, 'YXZ');
            renderer.render(scene, cam);
            hud.innerText = "MINECRAFT | BLOK: " + names[bid];
            loop = requestAnimationFrame(mcUpdate);
        } mcUpdate();
    }

    // --- SNAKE 5.1 ---
    function runSnake() {
        const stage = document.getElementById('game-canvas');
        stage.innerHTML = '<canvas id="snC" width="900" height="500"></canvas>';
        const cvs = document.getElementById('snC'), ctx = cvs.getContext('2d');
        let s = [{x:200, y:200}], f = {x:400, y:200}, d = 'R', lastT = 0, score = 0;

        function snLoop(t) {
            if(t - lastT > 90) {
                lastT = t; let h = {...s[0]};
                if(keys['ArrowUp'] && d !== 'D') d = 'U'; if(keys['ArrowDown'] && d !== 'U') d = 'D';
                if(keys['ArrowLeft'] && d !== 'R') d = 'L'; if(keys['ArrowRight'] && d !== 'L') d = 'R';
                if(d === 'U') h.y -= 20; if(d === 'D') h.y += 20; if(d === 'L') h.x -= 20; if(d === 'R') h.x += 20;
                if(h.x === f.x && h.y === f.y) { score++; f = {x: Math.floor(Math.random()*44)*20, y: Math.floor(Math.random()*24)*20}; } else s.pop();
                if(h.x < 0 || h.x >= 900 || h.y < 0 || h.y >= 500) return launch('snake');
                s.unshift(h);
                ctx.fillStyle = "#000"; ctx.fillRect(0,0,900,500);
                ctx.fillStyle = var(--accent); s.forEach(p => ctx.fillRect(p.x, p.y, 18, 18));
                ctx.fillStyle = "red"; ctx.fillRect(f.x, f.y, 18, 18);
                hud.innerText = "SNAKE SCORE: " + score;
            }
            loop = requestAnimationFrame(snLoop);
        } snLoop();
    }
</script>
</body>
</html>
