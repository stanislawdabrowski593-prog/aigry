<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>AIGRY v6.2 - Ultimate Fix</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root { --mc: #2ecc71; --mario: #e74c3c; --bg: #050505; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        header { background: #111; width: 100%; padding: 10px; border-bottom: 3px solid #333; display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .btn { background: #222; color: #fff; border: 1px solid #444; padding: 10px 20px; cursor: pointer; border-radius: 6px; font-weight: bold; }
        .btn:hover { background: #333; border-color: #eee; }

        #main-container { display: flex; width: 1280px; height: 620px; background: #000; border: 4px solid #1a1a1a; border-radius: 12px; margin-top: 10px; position: relative; }
        #game-view { flex-grow: 1; position: relative; cursor: crosshair; }
        #sidebar { width: 280px; background: #0a0a0a; border-left: 2px solid #222; padding: 20px; font-size: 13px; color: #ccc; }
        
        #hud { position: absolute; top: 15px; left: 15px; z-index: 50; font-family: 'Courier New', monospace; pointer-events: none; }
        #crosshair { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 24px; display: none; pointer-events: none; z-index: 100; }
        .hotbar { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: none; gap: 5px; background: rgba(0,0,0,0.7); padding: 5px; border: 2px solid #444; }
        .slot { width: 40px; height: 40px; border: 2px solid #666; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .slot.active { border-color: yellow; background: rgba(255,255,0,0.2); }
    </style>
</head>
<body>

<header>
    <div style="font-weight: 900; font-size: 20px;">AIGRY <span style="color:var(--mario)">v6.2 FIX</span></div>
    <div class="nav">
        <button class="btn" onclick="init('mario')">MARIO WORLD</button>
        <button class="btn" onclick="init('mc')">MINECRAFT AI</button>
        <button class="btn" onclick="init('snake')">SNAKE HD</button>
    </div>
</header>

<div id="main-container">
    <div id="game-view">
        <div id="hud">Wybierz grę powyżej ⬆️</div>
        <div id="crosshair">+</div>
        <div id="canvas-container" style="width:100%; height:100%;"></div>
        <div id="hotbar" class="hotbar">
            <div class="slot active" id="s1">1</div>
            <div class="slot" id="s2">2</div>
            <div class="slot" id="s3">3</div>
            <div class="slot" id="s4">4</div>
        </div>
    </div>
    <div id="sidebar">
        <h3 id="side-title">LOG AKTUALIZACJI</h3>
        <div id="side-desc">Naprawiono kolizje i błędy renderowania.</div>
    </div>
</div>

<script>
    let scene, camera, renderer, loop, keys = {}, score = 0, level = 1, blocks = [];
    let selectedBlock = 0;
    const colors = [0x2ecc71, 0x8b4513, 0xffd700, 0x3498db]; // Trawa, Ziemia, Złoto, Lapis
    const container = document.getElementById('canvas-container');

    window.onkeydown = e => { 
        keys[e.code] = true; 
        if(e.code.startsWith('Digit')) {
            let d = parseInt(e.code.replace('Digit',''));
            if(d >= 1 && d <= 4) {
                selectedBlock = d - 1;
                document.querySelectorAll('.slot').forEach((s, i) => s.className = (i === selectedBlock ? 'slot active' : 'slot'));
            }
        }
    };
    window.onkeyup = e => keys[e.code] = false;

    function init(game) {
        if(loop) cancelAnimationFrame(loop);
        container.innerHTML = "";
        document.getElementById('crosshair').style.display = "none";
        document.getElementById('hotbar').style.display = "none";
        score = 0; level = 1;

        if(game === 'mario') {
            document.getElementById('side-desc').innerHTML = "<b>Mario Fix:</b><br>• Stabilna podłoga<br>• Przeszkody na Level 2<br>• Poprawione hitboxy";
            runMario();
        } else if(game === 'mc') {
            document.getElementById('side-desc').innerHTML = "<b>MC Fix:</b><br>• Prawidłowe stawianie bloków (LPM)<br>• Usuwanie bloków (PPM)<br>• Wybór bloków 1-4";
            runMC();
        }
    }

    // --- NAPRAWIONY MARIO ---
    function runMario() {
        const cvs = document.createElement('canvas');
        cvs.width = 1000; cvs.height = 620;
        container.appendChild(cvs);
        const ctx = cvs.getContext('2d');
        let p = { x: 100, y: 500, vy: 0, j: false };
        let obstacles = level === 1 ? [] : [{x: 400, w: 50, h: 60}, {x: 700, w: 50, h: 100}];

        function draw() {
            ctx.fillStyle = level === 1 ? "#5c94fc" : "#141414";
            ctx.fillRect(0, 0, 1000, 620);
            
            // Podłoga
            ctx.fillStyle = "#8b4513"; ctx.fillRect(0, 560, 1000, 60);
            ctx.fillStyle = "#2ecc71"; ctx.fillRect(0, 560, 1000, 10);

            // Przeszkody
            ctx.fillStyle = "green";
            obstacles.forEach(o => {
                ctx.fillRect(o.x, 560 - o.h, o.w, o.h);
                if(p.x + 30 > o.x && p.x < o.x + o.w && p.y + 40 > 560 - o.h) {
                    p.x = 50; // Reset przy uderzeniu
                }
            });

            // Ruch
            if(keys['ArrowRight'] || keys['KeyD']) p.x += 5;
            if(keys['ArrowLeft'] || keys['KeyA']) p.x -= 5;
            if((keys['ArrowUp'] || keys['Space']) && !p.j) { p.vy = -15; p.j = true; }

            p.vy += 0.8; p.y += p.vy;
            if(p.y > 520) { p.y = 520; p.vy = 0; p.j = false; }

            // Postać Mario (v6.2 design)
            ctx.fillStyle = "red"; ctx.fillRect(p.x+5, p.y-5, 20, 5); // Czapka
            ctx.fillStyle = "#ffdbac"; ctx.fillRect(p.x, p.y, 30, 20); // Twarz
            ctx.fillStyle = "blue"; ctx.fillRect(p.x, p.y+20, 30, 20); // Spodnie
            ctx.fillStyle = "black"; ctx.fillRect(p.x+20, p.y+5, 5, 5); // Oko

            // Meta
            ctx.fillStyle = "yellow"; ctx.fillRect(950, 460, 10, 100);
            if(p.x > 930) {
                if(level === 1) { level = 2; p.x = 50; obstacles = [{x: 400, w: 50, h: 60}, {x: 700, w: 50, h: 100}]; }
                else { alert("GRATULACJE!"); init('mario'); return; }
            }

            document.getElementById('hud').innerText = `MARIO WORLD | LEVEL ${level}`;
            loop = requestAnimationFrame(draw);
        } draw();
    }

    // --- NAPRAWIONY MINECRAFT ---
    function runMC() {
        document.getElementById('crosshair').style.display = "block";
        document.getElementById('hotbar').style.display = "flex";
        scene = new THREE.Scene(); scene.background = new THREE.Color(0x87CEEB);
        camera = new THREE.PerspectiveCamera(75, 1000/620, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(1000, 620);
        container.appendChild(renderer.domElement);

        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 5); scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040));

        const geo = new THREE.BoxGeometry(1, 1, 1);
        for(let x=-5; x<5; x++) for(let z=-5; z<5; z++) {
            const b = new THREE.Mesh(geo, new THREE.MeshLambertMaterial({color: colors[0]}));
            b.position.set(x, 0, z); scene.add(b); blocks.push(b);
        }

        camera.position.set(0, 5, 8);
        camera.lookAt(0, 0, 0);

        // System stawiania/usuwania
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2(0, 0);

        renderer.domElement.onmousedown = (e) => {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(blocks);
            if(intersects.length > 0) {
                const intersect = intersects[0];
                if(e.button === 0) { // Lewy - Stawianie
                    const b = new THREE.Mesh(geo, new THREE.MeshLambertMaterial({color: colors[selectedBlock]}));
                    b.position.copy(intersect.point).add(intersect.face.normal).round();
                    scene.add(b); blocks.push(b);
                } else if(e.button === 2) { // Prawy - Usuwanie
                    if(intersect.object.position.y !== 0) { // Nie usuwaj ziemi
                        scene.remove(intersect.object);
                        blocks = blocks.filter(b => b !== intersect.object);
                    }
                }
            }
        };
        renderer.domElement.oncontextmenu = e => e.preventDefault();

        function draw() {
            let s = 0.1;
            if(keys['KeyW']) camera.translateZ(-s);
            if(keys['KeyS']) camera.translateZ(s);
            if(keys['KeyA']) camera.translateX(-s);
            if(keys['KeyD']) camera.translateX(s);
            if(keys['Space']) camera.position.y += s;
            if(keys['ShiftLeft']) camera.position.y -= s;

            renderer.render(scene, camera);
            document.getElementById('hud').innerText = "MINECRAFT AI | LPM: Buduj | PPM: Usuń | 1-4: Bloki";
            loop = requestAnimationFrame(draw);
        } draw();
    }
</script>
</body>
</html>
