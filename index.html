<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>AIGRY v3.9.1 - FULLSCREEN FIX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #050505; color: #fff; margin: 0; display: flex; flex-direction: column; align-items: center; }
        header { background: #111; width: 100%; padding: 10px; border-bottom: 2px solid #00d2ff; display: flex; justify-content: space-around; align-items: center; }
        .menu { display: flex; gap: 8px; margin: 15px; }
        button { background: #1a1a1a; color: #fff; border: 1px solid #333; padding: 10px 18px; cursor: pointer; border-radius: 5px; font-weight: bold; transition: 0.2s; }
        button:hover { border-color: #00d2ff; background: #222; box-shadow: 0 0 10px rgba(0,210,255,0.3); }
        
        /* GŁÓWNY KONTENER GRY */
        #game-wrapper { position: relative; width: 800px; height: 450px; background: #000; border: 3px solid #1a1a1a; border-radius: 8px; overflow: hidden; }
        #game-wrapper:fullscreen { width: 100vw; height: 100vh; border: none; border-radius: 0; }
        
        #ui { position: absolute; top: 15px; left: 15px; z-index: 10; font-weight: bold; text-shadow: 2px 2px #000; color: #00d2ff; pointer-events: none; font-size: 18px; }
        #crosshair { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); color: #fff; display: none; font-size: 24px; z-index: 5; pointer-events: none; }
        
        .fs-btn { margin: 10px; background: #00d2ff; color: #000; border: none; padding: 12px 25px; border-radius: 30px; font-weight: 900; cursor: pointer; text-transform: uppercase; }
        .fs-btn:hover { background: #00aacc; transform: scale(1.05); }
    </style>
</head>
<body oncontextmenu="return false;">

<header>
    <div style="font-size: 24px; font-weight: bold;">AIGRY <span style="color:#00d2ff">v3.9.1</span></div>
    <div class="menu">
        <button onclick="changeL('pl')">PL</button>
        <button onclick="changeL('en')">EN</button>
        <button onclick="changeL('de')">DE</button>
    </div>
</header>

<div class="menu">
    <button onclick="start('mario')">SUPER MARIO</button>
    <button onclick="start('mc')">MINECRAFT</button>
    <button onclick="start('snake')">SNAKE</button>
</div>

<div id="game-wrapper">
    <div id="ui">Wybierz grę / Choose game</div>
    <div id="crosshair">+</div>
    <div id="content" style="width:100%; height:100%;"></div>
</div>

<button class="fs-btn" onclick="toggleFS()">⛶ PEŁNY EKRAN (Klawisz F)</button>

<script>
    let loop, keys = {}, marioLvl = 1, lang = 'pl', activeGame = '';
    const wrapper = document.getElementById('game-wrapper');

    // OBSŁUGA KLAWIATURY
    window.onkeydown = e => { 
        keys[e.code] = true; 
        if(e.code === 'KeyF') toggleFS(); 
    };
    window.onkeyup = e => keys[e.code] = false;

    // --- NAPRAWIONA FUNKCJA FULLSCREEN ---
    function toggleFS() {
        if (!document.fullscreenElement) {
            if (wrapper.requestFullscreen) {
                wrapper.requestFullscreen();
            } else if (wrapper.webkitRequestFullscreen) { /* Safari */
                wrapper.webkitRequestFullscreen();
            }
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }
    }

    function changeL(l) { lang = l; if(activeGame) start(activeGame); }

    function start(game) {
        activeGame = game;
        if(loop) cancelAnimationFrame(loop);
        document.getElementById('content').innerHTML = "";
        document.getElementById('crosshair').style.display = "none";
        document.getElementById('ui').innerText = "";
        if(game === 'mario') loadMario();
        if(game === 'mc') loadMC();
        if(game === 'snake') loadSnake();
    }

    // --- MARIO ---
    function loadMario() {
        const cont = document.getElementById('content');
        cont.innerHTML = '<canvas id="mCnv"></canvas>';
        const cvs = document.getElementById('mCnv'), ctx = cvs.getContext('2d');
        
        function resize() {
            cvs.width = wrapper.clientWidth;
            cvs.height = wrapper.clientHeight;
        }
        window.addEventListener('resize', resize); resize();

        let p = {x: 50, y: 300, w: 32, h: 48, vx: 0, vy: 0, j: false};
        let camX = 0, goal = 2500;

        function mLoop() {
            if(keys['ArrowRight']) p.vx += 0.8; else if(keys['ArrowLeft']) p.vx -= 0.8; else p.vx *= 0.85;
            if((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && !p.j) { p.vy = -16; p.j = true; }
            p.vy += 0.7; p.x += p.vx; p.y += p.vy;

            let groundY = cvs.height - 50;
            if(p.y > groundY - p.h) { p.y = groundY - p.h; p.vy = 0; p.j = false; }
            if(p.x > cvs.width/2) camX = p.x - cvs.width/2;

            ctx.fillStyle = "#5c94fc"; ctx.fillRect(0,0,cvs.width,cvs.height);
            ctx.save(); ctx.translate(-camX, 0);
            
            ctx.fillStyle = "#8b4513"; ctx.fillRect(0, groundY, goal+1000, 50);
            ctx.fillStyle = "#2ecc71"; ctx.fillRect(0, groundY, goal+1000, 5);
            ctx.fillStyle = "gold"; ctx.fillRect(goal, groundY-200, 10, 200);
            ctx.fillStyle = "#e74c3c"; ctx.fillRect(p.x, p.y, p.w, p.h);
            
            ctx.restore();
            document.getElementById('ui').innerText = "MARIO LVL " + marioLvl;
            if(p.x > goal) { marioLvl++; start('mario'); }
            loop = requestAnimationFrame(mLoop);
        } mLoop();
    }

    // --- MINECRAFT (Z POPRAWIONYM DOPASOWANIEM) ---
    function loadMC() {
        document.getElementById('crosshair').style.display = "block";
        const scene = new THREE.Scene(); scene.background = new THREE.Color(0x87CEEB);
        const cam = new THREE.PerspectiveCamera(75, wrapper.clientWidth/wrapper.clientHeight, 0.1, 1000);
        const rend = new THREE.WebGLRenderer({antialias: true}); 
        rend.setSize(wrapper.clientWidth, wrapper.clientHeight);
        document.getElementById('content').appendChild(rend.domElement);
        
        window.onresize = () => {
            cam.aspect = wrapper.clientWidth / wrapper.clientHeight;
            cam.updateProjectionMatrix();
            rend.setSize(wrapper.clientWidth, wrapper.clientHeight);
        };

        const geo = new THREE.BoxGeometry(1,1,1);
        const mat = new THREE.MeshLambertMaterial({color: 0x2ecc71});
        for(let x=-5; x<5; x++) for(let z=-5; z<5; z++) {
            const b = new THREE.Mesh(geo, mat); b.position.set(x, 0, z); scene.add(b);
        }

        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        cam.position.set(0, 2, 5);

        rend.domElement.onclick = () => rend.domElement.requestPointerLock();
        let y=0, p=0;
        document.addEventListener('mousemove', e => {
            if(document.pointerLockElement === rend.domElement){
                y -= e.movementX*0.002; p -= e.movementY*0.002;
                p = Math.max(-1.5, Math.min(1.5, p));
            }
        });

        function mcLoop() {
            if(keys['KeyW']) cam.translateZ(-0.1); if(keys['KeyS']) cam.translateZ(0.1);
            if(keys['KeyA']) cam.translateX(-0.1); if(keys['KeyD']) cam.translateX(0.1);
            cam.rotation.set(p,y,0,'YXZ');
            rend.render(scene, cam);
            document.getElementById('ui').innerText = "MINECRAFT 3D";
            loop = requestAnimationFrame(mcLoop);
        } mcLoop();
    }

    // --- SNAKE ---
    function loadSnake() {
        const cont = document.getElementById('content');
        cont.innerHTML = '<canvas id="sCnv"></canvas>';
        const cvs = document.getElementById('sCnv'), ctx = cvs.getContext('2d');
        cvs.width = 800; cvs.height = 450;
        let s = [{x:200,y:200}], d = 'R', score = 0, last = 0;

        function sLoop(t) {
            if(t - last > 100) {
                last = t; let h = {...s[0]};
                if(keys['ArrowUp'] && d!=='D') d='U'; if(keys['ArrowDown'] && d!=='U') d='D';
                if(keys['ArrowLeft'] && d!=='R') d='L'; if(keys['ArrowRight'] && d!=='L') d='R';
                if(d==='U') h.y-=20; if(d==='D') h.y+=20; if(d==='L') h.x-=20; if(d==='R') h.x+=20;
                if(h.x<0||h.x>=800||h.y<0||h.y>=450) return start('snake');
                s.unshift(h); s.pop();
                ctx.fillStyle="#111"; ctx.fillRect(0,0,800,450);
                ctx.fillStyle="#00d2ff"; s.forEach(p=>ctx.fillRect(p.x,p.y,18,18));
                document.getElementById('ui').innerText = "SNAKE SCORE: " + score;
            }
            loop = requestAnimationFrame(sLoop);
        } loop = requestAnimationFrame(sLoop);
    }
</script>
</body>
</html>
