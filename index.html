<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>AIGRY v4.1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #050505; color: #fff; margin: 0; display: flex; flex-direction: column; align-items: center; }
        header { background: #111; width: 100%; padding: 10px; border-bottom: 2px solid #00d2ff; display: flex; justify-content: space-around; align-items: center; }
        .menu { display: flex; gap: 10px; margin: 15px; }
        button { background: #1a1a1a; color: #fff; border: 1px solid #333; padding: 10px 20px; cursor: pointer; border-radius: 4px; font-weight: bold; transition: 0.2s; }
        button:hover { border-color: #00d2ff; background: #222; }
        #game-container { position: relative; width: 800px; height: 450px; background: #000; border: 2px solid #1a1a1a; border-radius: 8px; overflow: hidden; }
        #game-container:fullscreen { width: 100vw; height: 100vh; border: none; }
        #overlay { position: absolute; top: 15px; left: 15px; z-index: 10; font-weight: bold; text-shadow: 2px 2px #000; color: #00d2ff; pointer-events: none; }
        #crosshair { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); color: #fff; display: none; font-size: 24px; z-index: 5; }
        .fs-bar { margin: 15px; }
    </style>
</head>
<body oncontextmenu="return false;">

<header>
    <div style="font-size: 22px; font-weight: bold;">AIGRY v4.1</div>
    <div class="menu">
        <button onclick="setL('pl')">PL</button>
        <button onclick="setL('en')">EN</button>
    </div>
</header>

<div class="menu">
    <button onclick="play('mario')">MARIO</button>
    <button onclick="play('mc')">MINECRAFT</button>
    <button onclick="play('snake')">SNAKE</button>
</div>

<div id="game-container">
    <div id="overlay"></div>
    <div id="crosshair">+</div>
    <div id="stage" style="width:100%; height:100%;"></div>
</div>

<div class="fs-bar">
    <button style="background:#00d2ff; color:#000;" onclick="toggleFS()">FULLSCREEN</button>
</div>

<script>
    let loop, keys = {}, level = 1, lang = 'pl', gameActive = '';
    const container = document.getElementById('game-container');

    window.onkeydown = e => { keys[e.code] = true; if(e.code === 'KeyF') toggleFS(); };
    window.onkeyup = e => keys[e.code] = false;

    function toggleFS() {
        if (!document.fullscreenElement) container.requestFullscreen();
        else document.exitFullscreen();
    }

    function setL(l) { lang = l; if(gameActive) play(gameActive); }

    function play(game) {
        gameActive = game;
        if(loop) cancelAnimationFrame(loop);
        document.getElementById('stage').innerHTML = "";
        document.getElementById('crosshair').style.display = (game === 'mc') ? "block" : "none";
        document.getElementById('overlay').innerText = "";
        if(game === 'mario') runMario();
        if(game === 'mc') runMC();
        if(game === 'snake') runSnake();
    }

    // --- MARIO ---
    function runMario() {
        const stage = document.getElementById('stage');
        stage.innerHTML = '<canvas id="c" width="800" height="450"></canvas>';
        const cvs = document.getElementById('c'), ctx = cvs.getContext('2d');
        let p = {x:50, y:300, w:30, h:40, vx:0, vy:0, j:false};
        let enemies = [], goal = 2000 + (level * 400), camX = 0;

        for(let i=1; i<6; i++) enemies.push({x: 500*i, y:370, vx:-2, w:30, h:30});

        function mLoop() {
            if(keys['ArrowRight'] || keys['KeyD']) p.vx = 5; else if(keys['ArrowLeft'] || keys['KeyA']) p.vx = -5; else p.vx = 0;
            if((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && !p.j) { p.vy = -15; p.j = true; }
            p.vy += 0.8; p.x += p.vx; p.y += p.vy;
            if(p.y > 360) { p.y = 360; p.vy = 0; p.j = false; }
            if(p.x > 300) camX = p.x - 300;

            ctx.fillStyle = "#5c94fc"; ctx.fillRect(0,0,800,450);
            ctx.save(); ctx.translate(-camX, 0);
            ctx.fillStyle = "#8b4513"; ctx.fillRect(0,400, goal+1000, 50);
            ctx.fillStyle = "red"; enemies.forEach(e => {
                e.x += e.vx; if(e.x < 0 || e.x > goal+500) e.vx*=-1;
                ctx.fillRect(e.x, e.y, e.w, e.h);
                if(p.x < e.x+e.w && p.x+p.w > e.x && p.y < e.y+e.h && p.y+p.h > e.y) play('mario');
            });
            ctx.fillStyle = "gold"; ctx.fillRect(goal, 100, 20, 300);
            ctx.fillStyle = "#fff"; ctx.fillRect(p.x, p.y, p.w, p.h);
            ctx.restore();
            document.getElementById('overlay').innerText = (lang === 'pl' ? "POZIOM " : "LEVEL ") + level;
            if(p.x > goal) { level++; play('mario'); }
            loop = requestAnimationFrame(mLoop);
        } mLoop();
    }

    // --- MINECRAFT ---
    function runMC() {
        const scene = new THREE.Scene(); scene.background = new THREE.Color(0x87CEEB);
        const cam = new THREE.PerspectiveCamera(75, 800/450, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(800, 450); document.getElementById('stage').appendChild(renderer.domElement);
        
        const colors = [0x2ecc71, 0x7f8c8d, 0x8b4513, 0xe67e22, 0xf1c40f];
        let blockIdx = 0, blocks = [];

        for(let x=-5; x<5; x++) for(let z=-5; z<5; z++) {
            const b = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshLambertMaterial({color: colors[0]}));
            b.position.set(x, 0, z); scene.add(b); blocks.push(b);
        }

        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        cam.position.set(0, 2, 5);
        renderer.domElement.onclick = () => renderer.domElement.requestPointerLock();
        
        let yaw = 0, pitch = 0;
        document.addEventListener('mousemove', e => {
            if(document.pointerLockElement === renderer.domElement) {
                yaw -= e.movementX*0.002; pitch -= e.movementY*0.002;
                pitch = Math.max(-1.5, Math.min(1.5, pitch));
            }
        });

        renderer.domElement.onmousedown = e => {
            if(document.pointerLockElement !== renderer.domElement) return;
            const dir = new THREE.Vector3(0,0,-1).applyQuaternion(cam.quaternion);
            const pos = new THREE.Vector3().copy(cam.position).add(dir.multiplyScalar(3)).round();
            if(e.button === 0) {
                const b = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshLambertMaterial({color: colors[blockIdx]}));
                b.position.copy(pos); scene.add(b); blocks.push(b);
            } else {
                blocks.forEach((b, i) => { if(b.position.distanceTo(pos) < 0.8) { scene.remove(b); blocks.splice(i, 1); }});
            }
        };

        function mcLoop() {
            if(keys['KeyW']) cam.translateZ(-0.1); if(keys['KeyS']) cam.translateZ(0.1);
            if(keys['KeyA']) cam.translateX(-0.1); if(keys['KeyD']) cam.translateX(0.1);
            if(keys['Digit1']) blockIdx = 0; if(keys['Digit2']) blockIdx = 1; if(keys['Digit3']) blockIdx = 2; if(keys['Digit4']) blockIdx = 3; if(keys['Digit5']) blockIdx = 4;
            cam.rotation.set(pitch, yaw, 0, 'YXZ');
            renderer.render(scene, cam);
            document.getElementById('overlay').innerText = (lang === 'pl' ? "BLOK: " : "BLOCK: ") + (blockIdx + 1);
            loop = requestAnimationFrame(mcLoop);
        } mcLoop();
    }

    // --- SNAKE ---
    function runSnake() {
        const stage = document.getElementById('stage');
        stage.innerHTML = '<canvas id="sc" width="800" height="450"></canvas>';
        const cvs = document.getElementById('sc'), ctx = cvs.getContext('2d');
        let s = [{x:200, y:200}], f = {x:400, y:200}, d = 'R', lastT = 0, pts = 0;

        function sLoop(t) {
            if(t - lastT > 100) {
                lastT = t; let h = {...s[0]};
                if(keys['ArrowUp'] && d !== 'D') d = 'U'; if(keys['ArrowDown'] && d !== 'U') d = 'D';
                if(keys['ArrowLeft'] && d !== 'R') d = 'L'; if(keys['ArrowRight'] && d !== 'L') d = 'R';
                if(d === 'U') h.y -= 20; if(d === 'D') h.y += 20; if(d === 'L') h.x -= 20; if(d === 'R') h.x += 20;
                if(h.x === f.x && h.y === f.y) { pts++; f = {x: Math.floor(Math.random()*39)*20, y: Math.floor(Math.random()*22)*20}; } else s.pop();
                if(h.x < 0 || h.x >= 800 || h.y < 0 || h.y >= 450) return play('snake');
                s.unshift(h);
                ctx.fillStyle = "#0a0a0a"; ctx.fillRect(0,0,800,450);
                ctx.fillStyle = "#00d2ff"; s.forEach(p => ctx.fillRect(p.x, p.y, 18, 18));
                ctx.fillStyle = "#ff4757"; ctx.fillRect(f.x, f.y, 18, 18);
                document.getElementById('overlay').innerText = "SCORE: " + pts;
            }
            loop = requestAnimationFrame(sLoop);
        } loop = requestAnimationFrame(sLoop);
    }
</script>
</body>
</html>
